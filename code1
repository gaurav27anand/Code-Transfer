import pandas as pd
import plotly.graph_objects as go

# Sample Data (replace with your actual data)
data = [
    ('123', 'abc', 'SUCCESS', 123455),
    ('124', 'def', 'FAILURE', 234567),
    # Add more tuples as needed
]

# Creating a DataFrame from the list
df = pd.DataFrame(data, columns=['runID', 'pipeline_name', 'result', 'durationinmillis'])
df['duration_in_minutes'] = df['durationinmillis'] / (60 * 1000)

# Define the base URL
base_url = "http://yourbaseurl.com/run-details?runID="  # Replace with your actual base URL

# Generate the URLs for each runID
df['run_link'] = base_url + df['runID']

# Create clickable links for each runID
clickable_runIDs = [f'<a href="{url}">{runID}</a>' for runID, url in zip(df['runID'], df['run_link'])]

# Create a bar chart with Plotly
colors = ['green' if result == 'SUCCESS' else 'red' for result in df['result']]

fig = go.Figure(data=[
    go.Bar(
        x=df['runID'],  # Use original runID here for plotting
        y=df['duration_in_minutes'],
        marker_color=colors
    )
])

# Update the layout with clickable X-axis labels
fig.update_layout(
    title='Pipeline Runtime per Run',
    xaxis_title='Run ID',
    yaxis_title='Runtime (minutes)',
    barmode='group',
    xaxis=dict(
        tickvals=df['runID'],  # Original runID values
        ticktext=clickable_runIDs,  # Use clickable links as tick labels
    )
)

# Save the graph to an HTML snippet with clickable X-axis links
graph_html = 'pipeline_runtime_graph.html'
fig.write_html(graph_html)